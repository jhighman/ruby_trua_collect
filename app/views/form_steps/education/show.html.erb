<% content_for :title, "Education Information" %>

<%= render layout: 'form_submissions/shared/accumulator_layout', locals: {
  form_submission: @form_submission,
  step_id: @step_id,
  navigation_state: @navigation_state,
  entries: @entries,
  requirements: @requirements,
  completion_percentage: @completion_percentage,
  entry_display_method: lambda { |entry|
    content_tag(:div) do
      concat content_tag(:strong, entry['institution'])
      if entry['degree'].present?
        concat " - #{entry['degree']}"
        if entry['field_of_study'].present?
          concat " in #{entry['field_of_study']}"
        end
      end
      concat tag(:br)
      concat "#{entry['start_date']} - #{entry['is_current'] ? 'Present' : entry['end_date']}"
      if entry['location'].present?
        concat " (#{entry['location']})"
      end
    end
  },
  additional_fields_partial: 'form_steps/education/highest_level'
} do |form| %>
  <div class="form-group">
    <label for="form_submission_institution">Institution</label>
    <%= form.text_field :institution, class: 'form-control', required: true %>
  </div>
  
  <div class="form-group">
    <label for="form_submission_degree">Degree</label>
    <%= form.text_field :degree, class: 'form-control' %>
  </div>
  
  <div class="form-group">
    <label for="form_submission_field_of_study">Field of Study</label>
    <%= form.text_field :field_of_study, class: 'form-control' %>
  </div>
  
  <div class="form-group">
    <label for="form_submission_location">Location</label>
    <%= form.text_field :location, class: 'form-control' %>
  </div>
  
  <div class="form-group">
    <label for="form_submission_start_date">Start Date</label>
    <%= form.date_field :start_date, class: 'form-control', required: true %>
  </div>
  
  <div class="form-group">
    <div class="checkbox">
      <%= form.check_box :is_current, class: 'form-check-input' %>
      <label for="form_submission_is_current">Currently attending</label>
    </div>
  </div>
  
  <div class="form-group" id="end_date_group">
    <label for="form_submission_end_date">End Date</label>
    <%= form.date_field :end_date, class: 'form-control' %>
  </div>
<% end %>

<script>
  // Simple script to show/hide end date based on is_current checkbox
  document.addEventListener('DOMContentLoaded', function() {
    var isCurrentCheckbox = document.getElementById('form_submission_is_current');
    var endDateGroup = document.getElementById('end_date_group');
    
    function toggleEndDate() {
      if (isCurrentCheckbox.checked) {
        endDateGroup.style.display = 'none';
      } else {
        endDateGroup.style.display = 'block';
      }
    }
    
    if (isCurrentCheckbox) {
      isCurrentCheckbox.addEventListener('change', toggleEndDate);
      toggleEndDate(); // Initial state
    }
  });
</script>