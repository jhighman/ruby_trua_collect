<div class="form-wizard-container">
  <div class="form-wizard-header">
    <h1 class="form-wizard-title">Review Your Information</h1>
    <p class="form-wizard-description">Please review all the information you've provided before final submission.</p>
  </div>

  <div class="form-wizard-content">
    <% @navigation = @form_submission.navigation %>
    <% completed_steps = @navigation.completed_steps %>
    
    <% completed_steps.each do |step_id| %>
      <% next if step_id == 'review' %>
      <% step_values = @form_submission.step_values(step_id) %>
      
      <% if step_values.present? %>
        <div class="bg-white shadow-md rounded-lg p-6 mb-6">
          <h2 class="text-xl font-semibold mb-4"><%= step_id.humanize %></h2>
          
          <div class="space-y-4">
            <% step_values.each do |key, value| %>
              <% next if key == 'entries' || value.blank? %>
              <div class="grid grid-cols-3 gap-4">
                <div class="font-medium text-gray-700"><%= key.humanize %></div>
                <div class="col-span-2"><%= value %></div>
              </div>
            <% end %>
            
            <% if step_values['entries'].present? %>
              <h3 class="text-lg font-medium mt-4 mb-2">Entries</h3>
              
              <% step_values['entries'].each_with_index do |entry, index| %>
                <div class="bg-gray-50 p-4 rounded-md mb-4">
                  <h4 class="font-medium mb-2"><%= entry['company'] %> - <%= entry['position'] %></h4>
                  
                  <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <p class="font-medium text-gray-700">Start Date</p>
                        <p><%= entry['start_date'] %></p>
                      </div>
                      <div>
                        <p class="font-medium text-gray-700">End Date</p>
                        <p><%= entry['is_current'] == '1' ? 'Current' : entry['end_date'] %></p>
                      </div>
                    </div>
                    
                    <div>
                      <p class="font-medium text-gray-700">Location</p>
                      <p><%= entry['city'] %>, <%= entry['state_province'] %>, <%= entry['country'] %></p>
                    </div>
                    
                    <% if entry['description'].present? %>
                      <div>
                        <p class="font-medium text-gray-700">Description</p>
                        <p><%= entry['description'] %></p>
                      </div>
                    <% end %>
                    
                    <% if entry['no_contact'] == '1' %>
                      <div>
                        <p class="font-medium text-gray-700">Contact Information</p>
                        <p class="italic text-gray-500">No contact information available</p>
                      </div>
                    <% elsif entry['contact_name'].present? || entry['contact_email'].present? || entry['contact_phone'].present? %>
                      <div>
                        <p class="font-medium text-gray-700">Contact Information</p>
                        <% if entry['contact_name'].present? %>
                          <p><span class="font-medium">Name:</span> <%= entry['contact_name'] %></p>
                        <% end %>
                        <% if entry['contact_email'].present? %>
                          <p><span class="font-medium">Email:</span> <%= entry['contact_email'] %></p>
                        <% end %>
                        <% if entry['contact_phone'].present? %>
                          <p><span class="font-medium">Phone:</span> <%= entry['contact_phone'] %></p>
                        <% end %>
                      </div>
                    <% end %>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>

  <%= form_with url: submit_form_submission_path(@form_submission), method: :post, class: "mt-8" do |f| %>
    <div class="form-wizard-footer flex justify-between">
      <div>
        <%= link_to "Back", form_submission_path(id: @form_submission.id, step_id: @navigation.previous_step('review')),
            class: "inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none h-10 py-2 px-4 border border-input bg-background hover:bg-accent hover:text-accent-foreground" %>
      </div>
      <div>
        <%= render_button 'Submit', as: :submit, variant: :primary %>
      </div>
    </div>
  <% end %>
</div>